@model Business.Gig

@{
    Layout = Layout;
    var html = "";
    var h = "";
    var subscriptions = Model.GigSubscriptionList != null ? Model.GigSubscriptionList.Count() : 0;
    var activeOrders = Model.GigActiveOrdersList != null ? Model.GigActiveOrdersList.Count() : 0;
}

@*<script src="@Url.Content("~/Scripts/jquery-1.10.2.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Content/js/bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Content/js/wow.min.js")"></script>

    <script src="@Url.Content("~/Content/js/bootstrap-datepicker.min.js")"></script>
    <script src="@Url.Content("~/Content/js/chosen.jquery.js")" type="text/javascript" charset="utf-8"></script>
    <script src="@Url.Content("~/Content/js/init.js")" type="text/javascript" charset="utf-8"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>*@
<script type="text/javascript" src="@Url.Content("~/Content/js/dropzone.js")"></script>
<!-----Notification start-->
<script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
<script src="~/signalr/hubs"></script>
<script type="text/javascript">
    $(function () {
        $("#FormSubscription").validate({

            errorClass: "error_span",
            errorElement: "span",
            rules: {

                bidmessage: {
                    required: true,

                },
                GigCompletionDate: {
                    required: true,
                    dateFormat : true,
                },
                GigTitle:{
                    required: true,

                }
            },
            messages: {
                bidmessage: {
                    required: "Please provide a job description",
                    //minlength: "Your password must be at least 5 characters long"
                },
                GigCompletionDate:{

                    required:"Please tell us your job completion date",

                    dateFormat:"Please enter a valid date"

                },
                GigTitle:{
                    required:"Please tell us your job title",

                }

            },
            highlight: function(element, errorClass) {
                $(element).removeClass(errorClass);
            },

            submitHandler: function (form) {
                debugger;
                $("#ui-datepicker-div").css("display", "none")
                var _hubidSend=  $.connection.hub.id;
                var gigtitle = hdngigtitle.value;
                $("#span_gig_subs").text(gigtitle + ' Service?');
                openbox(1, 'gig_subscription_id');

            },
            invalidHandler: function(event, validator) {
                debugger;
                $("#ui-datepicker-div").css("display", "none")
            }
        });

        $.validator.addMethod(
    "dateFormat",
    function(value, element) {
        debugger;
        var check = false;
        var re = /^\d{1,2}\/\d{1,2}\/\d{4}$/;
        if( re.test(value)){
            var adata = value.split('/');
            var dd = parseInt(adata[0],10);
            var mm = parseInt(adata[1],10);
            var yyyy = parseInt(adata[2],10);
            var xdata = new Date(yyyy,mm-1,dd);
            if ( ( xdata.getFullYear() === yyyy ) && ( xdata.getMonth () === mm - 1 ) && ( xdata.getDate() === dd ) ) {
                check = true;
            }
            else {
                check = false;
            }
        } else {
            check = false;
        }
        return this.optional(element) || check;
    },
    "Wrong date format"
);
    });
</script>
<script type="text/javascript">

    $(document).ready(function () {
        $("#jobcompletionDate").click(function(){

            $("#ui-datepicker-div").css("display", "block")
        })
        $("#anchor_home").click(function () {

            localStorage.removeItem("frmPage");
            window.location.href = "/Dashboard/Home";
        })


        //$("#ulcategory").on('click', 'a', function () {


        //    var _id = $(this).prop("id");
        //    localStorage.setItem("catid", _id);
        //    var _text = titleCase($(this).text());
        //    localStorage.setItem("cattext", _text)
        //    window.location.href = "/Category/index?id=" + _id;
        //})

        //$("#ulcategoryfooter").on('click', 'a', function () {
        //    var _id = $(this).prop("id");
        //    localStorage.setItem("catid", _id);
        //    var _text = titleCase($(this).text());
        //    localStorage.setItem("cattext", _text)
        //    window.location.href = "/Category/index?id=" + _id;
        //})
        //$("#ulfootertopcat").on('click', 'a', function () {
        //    var _id = $(this).prop("id");
        //    localStorage.setItem("catid", _id);
        //    var _text = titleCase($(this).text());
        //    localStorage.setItem("cattext", _text)
        //    window.location.href = "/Category/index?id=" + _id;
        //})
        function titleCase(str) {
            str = str.toLowerCase();
            str = str.split(' ');
            for (var i = 0; i < str.length; i++) {
                str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1);
            }
            return str.join(' ');
        }

        if ('@Model.GigStatus' != "R" && '@Model.ActiveGigs' == 0 && '@Model.SubscriedGigs' == 0)
        {
            $('#servicePostEdit').show();
        } else {
            $('#servicePostEdit').hide();
        }


                $("#anchor_home").click(function () {

                    localStorage.removeItem("frmPage");

                    window.location.href = "/Dashboard/Home";
                })

                $(".gig_review_all_bg").hide();
                var ReviewCount = @Html.Raw(Json.Encode(TempData["ReviewCount"]));
                $(".gig_review_slidebu").click(function()
                {
                    if(ReviewCount > 0)
                    {
                        $(".gig_review_all_bg").slideToggle();
                        $(".gig_review_slidebu").toggleClass("arrow_upshow");
                    }
                    return false;
                });

                //var showChar = 100;
                //var ellipsestext = "...";
                //var moretext = "Read More";
                //var lesstext = "Read less";
                //$('.more').each(function() {
                //    var content = $(this).html();

                //    if(content.length > showChar) {

                //        var c = content.substr(0, showChar);
                //        var h = content.substr(showChar-1, content.length - showChar);

                //        var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="#" class="morelink">' + moretext + '</a></span>';

                //        $(this).html(html);
                //    }

                //});

                //$("#divjobs").on("click", ".morelink", function(){
                //    if($(this).hasClass("less")) {
                //        $(this).removeClass("less");
                //        $(this).html(moretext);
                //    } else {
                //        $(this).addClass("less");
                //        $(this).html(lesstext);
                //    }
                //    $(this).parent().prev().toggle();
                //    $(this).prev().toggle();
                //    return false;
                //});

                $("#divjobs").on("click", " #btnloadmore", function (e) {
                    debugger;
                    var _Id = $('div.company_profile_refedit').last().find('input[id^="hfgigreviewid_"]').val();
                    var gigid = $("#hdnGigId").val();
                    LoadMore(_Id, gigid);
                    e.preventDefault();
                });

                function LoadMore(id, gigid) {

                    debugger;
                    $.ajax({
                        type: 'POST',
                        cache: false,
                        url: '@Url.Action("LoadMoreReview", "Gigs")',
                        data: {
                            'id': id,
                            "gigid": gigid
                        },
                        success: function (response) {
                            $("#divloadmore").remove();
                            genaratehtml(response);
                        },
                        error: function (jqXHR, exception) {
                            console.log(jqXHR.status);
                            console.log(exception);
                        }
                    });
                }

                function genaratehtml(response)
                {
                    $.each(response, function (key, value) {
                        var elem = " ";
                        elem = "<div class='box_paddleftright_15 clearfix'>";
                        elem = elem + "<div class='client_profile_imgname_bg clearfix'>";
                        elem = elem + "<div class='pull-left'>";
                        elem = elem + "<div class='client_profile_pic'>";
                        elem = elem + "<div class='client_profile_pic_1'>";
                        elem = elem + "<img src='"+response[key].ProfilePic+"' alt='' />";
                        elem = elem + "</div>";
                        elem = elem + "<i class='profile_pic_star'></i>";
                        elem = elem + "</div>";
                        elem = elem + "<div class='client_profile_name'>";
                        var _href = "javascript:;";
                        elem = elem + "<a href=" + _href + " style='cursor:default;'><h4>" + response[key].FullName + "</h4></a>";
                        elem = elem + "<span>"+response[key].CreatedDateDisplay+"</span>";
                        elem = elem + "</div>";
                        elem = elem + "</div>";
                        elem = elem + "<div class='pull-right text-right'>";
                        elem = elem + "<div class='company_profile_refedit'>";
                        var hfgigreviewid_ = "hfgigreviewid_" + response[key].GigReviewId;
                        elem = elem + "<input type='hidden' id=" + hfgigreviewid_ + " value=" + response[key].GigReviewId + " />";
                        elem = elem + "<div class='profile_public_banner_rate_only'>";

                        elem = elem + "<ul class='clearfix'>";
                        if (response[key].JobSeekerRatingInt == 1)
                        {
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                        }
                        else if (response[key].JobSeekerRatingInt == 2)
                        {
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                        }
                        else if (response[key].JobSeekerRatingInt == 3)
                        {
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                        }
                        else if (response[key].JobSeekerRatingInt == 4)
                        {
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li class='star_gray'><i></i></li>";
                        }
                        else if (response[key].JobSeekerRatingInt == 5)
                        {
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                            elem = elem + "<li><i></i></li>";
                        }
                        elem = elem + "</ul>";
                        elem = elem + "</div>";
                        elem = elem + "</div>";
                        elem = elem + "</div>";
                        elem = elem + "</div>";
                        elem = elem + "<div class='col-md-12 home_client_discription_small clearfix'>";
                        elem = elem + "<div class='readmoretext more'>"+response[key].Review +"</div>";
                        elem = elem + "</div>";
                        elem = elem + "</div>";


                        $("#divjobs").append(elem);
                        elem = " ";
                    })


                    var _morebutton = response[0].Isloadmore;
                    if (_morebutton == 1) {
                        var _elment2 = " ";
                        _elment2 = _elment2 + "<div class='col-md-12 category_loadmore_bg clearfix' id='divloadmore'>";
                        _elment2 = _elment2 + " <a href='javascript:' class='btn button_all secondary_color_bg' id='btnloadmore'>Load more</a></div></div>";
                        $("#divjobs").append(_elment2)
                    }
                }
                //var showChar = 100;
                //var ellipsestext = "...";
                //var moretext = "Read More";
                //var lesstext = "Read less";
                //$('.more').each(function() {
                //    debugger;
                //    var content = $(this).html();
                //    var _text=$($.parseHTML(content)).filter('.moreellipses').text();
                //    if(_text=="")
                //    {
                //        if(content.length > showChar) {
                //            var c = content.substr(0, showChar);
                //            var h = content.substr(showChar-1, content.length - showChar);
                //            var html = c + '<span class="moreellipses">' + ellipsestext+ '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="#" class="morelink">' + moretext + '</a></span>';
                //            $(this).html(html);
                //        }
                //    }


                //});
                $(".attachments").click(function () {

                    loadSubscriptionDoc();
                })


                if("@Session["JobCategoryName"]"==null || "@Session["JobCategoryName"]"=="")
                {
                    $("#category").remove();
                    var _catheader="@Session["JobCategoryHeader"]";
                    $("#spanheder").text(_catheader);
                }
                else
                {
                    var _cat = "@Session["JobCategoryName"]";

                    var _catid="@Session["JobCategoryId"]";

                    var _catheader="@Session["JobCategoryHeader"]";




                    // localStorage.setItem("frmPageCatId", _catid);
                    //var _cat=  localStorage.getItem("cattext")
                    $("#spanheder").text(_catheader);
                    //var _catid=  localStorage.getItem("catid");
                    var categoryurl="<a  id="+_catid+" class='details' href='/Category/Index?id="+_catid+"'>"+_cat+"</a>";

                    $("#category").html(categoryurl);
                }

                debugger;
                var GigSubscriptionId = @Html.Raw(Json.Encode(TempData["GigSubscriptionId"]));
                if(GigSubscriptionId>0)
                {

                    $("#headbid").html("Edit Order");
                    $("#btnsubscribe").val("Update Order");
                    $("#span_sub_tit").text("Update confirmation");
                    $("#span_sub_tit_msg").text("Are you sure you want to update this ");
                }
                else
                {
                    //$('#BidAmountinDollar').html("0.00");
                    $("#headbid").html("Purchase Service");
                    $("#btnsubscribe").val("Place Order");
                    $("#span_sub_tit").text("Purchase confirmation");
                    $("#span_sub_tit_msg").text("Are you sure you want to purchase this ");
                }

                $('#sandbox-container input').datepicker({
                    startDate: "dateToday",
                    minDate : "dateToday",
                    dateFormat: 'dd/mm/yy',
                    icons: {
                        time: "fa fa-clock-o",
                        date: "fa fa-calendar",
                        up: "fa fa-arrow-up",
                        down: "fa fa-arrow-down"
                    },
                    todayHighlight:'TRUE',
                    autoclose: true,
                }).on('changeDate', function(e){
                    $('#frm').validate();
                });

                //$("#btnsubscribe").click(function () {
                //    var gigtitle = hdngigtitle.value;
                //    $("#span_gig_subs").text(gigtitle + ' Gig?');
                //    openbox(1, 'gig_subscription_id');
                //});
            })

                function removeDoc()
                {
                    var id=$('#hdndelconfirmdocid').val();
                    closebox('gig_subscriptiondocdelete');
                    debugger
                    $.ajax({
                        url: '@Url.Action("DeleteGigSubcriptionDocuments", "Gigs")',
                        data: {
                            "GigSubscriptionDocId": id
                        },
                        type: "POST",
                        success: function (response) {

                            if(response != "Failed")
                            {
                                $("#view_attachment_ul").empty();
                                $.each(response, function (key, value) {
                                    var _documentName = response[key].DocumentName;
                                    var subdocid=response[key].GigSubscriptionDocumentId;

                                    $("#view_attachment_ul").append('<li><a href="/Dashboard/DownloadFile?FileName=' + _documentName + '" id ="'+ _documentName +'"><span class="tab">'+_documentName+'</span></a>&nbsp;&nbsp;<a href="#" onclick="ConfirmDeletion(this.id)" id ="'+ subdocid+'"><span class="tab"><i class="fa fa-trash-o text-danger"></i></span></a></li>');
                                });

                                openbox(1,'attachement_pop_id');
                            }
                            else
                            {
                                $('#divviewattachment').remove();
                                $("#view_attachment_ul").empty();
                                $("#view_attachment_ul").append('<li class="nofiles"><span class="tab">No more files to delete</span></li>')
                                openbox(1,'attachement_pop_id');
                            }
                        },
                        error: function () {

                        }
                    });
                }
                function loadSubscriptionDoc()
                {
                    var _GigSubscriptionId = @Html.Raw(Json.Encode(TempData["GigSubscriptionId"]));
                    $.ajax({
                        url: '@Url.Action("GigSubcriptionDocuments", "Gigs")',
                        data: {
                            "GigSubscriptionId": _GigSubscriptionId
                        },
                        type: "POST",
                        success: function (response) {
                            if(response != "Failed")
                            {
                                $("#view_attachment_ul").empty();
                                $.each(response, function (key, value) {
                                    var _documentName = response[key].DocumentName;
                                    var subdocid=response[key].GigSubscriptionDocumentId;

                                    $("#view_attachment_ul").append('<li><a href="/Dashboard/DownloadFile?FileName=' + _documentName + '" id ="'+ _documentName +'"><span class="tab">'+_documentName+'</span></a>&nbsp;&nbsp;<a href="#" onclick="ConfirmDeletion(this.id)" id ="'+ subdocid+'"><span class="tab"><i class="fa fa-trash-o text-danger"></i></span></a></li>');
                                });

                                openbox(1,'attachement_pop_id');
                            }
                            else
                            {
                                $('#divviewattachment').remove();
                            }
                        },
                        error: function () {

                        }
                    });
                }
                function cancelDel()
                {
                    closebox('gig_subscriptiondocdelete')
                    loadSubscriptionDoc();
                }
                function ConfirmDeletion(id)
                {
                    $('#hdndelconfirmdocid').val(id);
                    closebox('attachement_pop_id');
                    openbox(1,'gig_subscriptiondocdelete');
                }
                function MakeSubscription()
                {
                    debugger;
                    var gigdescription = $("#bidmessage").val();
                    var gigid = $("#hdnGigId").val();
                    var gigsubscriptionid = $("#hdnGigSubscriptionId").val();
                    var jobposterid = "@Session["UserId"]";
                    var gigtitle=$("#hdngigtitle").val();
                    var jobseekerid=$("#hdnseekerid").val();
                    var jobcompletiondate = $("#jobcompletionDate").val()
                    var _Title=$("#GigTitle").val();
                    //if (gigsubscriptionid == "") {
                    //    gigsubscriptionid = 0;
                    //}
                    //else
                    //{
                    //    $("#spnOffer").html("Offer updated!");
                    //    $("#spnCongrats").html("Congrats! You have updated the offer on job ");
                    //}

                    $.ajax({
                        type: 'POST',
                        cache: false,
                        url: '@Url.Action("SaveGigSubscription", "Gigs")',
                        beforeSend: function() {
                            $("#loaderDiv").show();
                        },
                        data: {
                            "GigId": gigid,
                            "JobPosterId": jobposterid,
                            "Description": gigdescription,
                            "JobCompletionDate": jobcompletiondate  ,
                            "Title":_Title,
                            "GigSubscriptionId":gigsubscriptionid
                        },
                        success: function (data) {
                            $("#loaderDiv").hide();
                            var notification = $.connection.notificationHub;
                            var _sendUserId = "@Session["UserId"]";
                            var _fullname =  "@Session["FullName"]";
                            var _receiverUserId = jobseekerid;
                            debugger;
                            var _notification  = ""+ _Title +" has been purchased by " + _fullname;
                            var _header = "Service order";
                            //if(gigsubscriptionid == 0)
                            //{
                            //    _notification  = ""+ $("#hdngigtitle").val() +" has been subscribed by " + _fullname;
                            //    _header = "Gig subscription";
                            //}
                            //else
                            //{
                            //    _notification  = "Subscription for gig " + $("#hdngigtitle").val() + "  has been updated by " + _fullname;
                            //    _header = "Gig Subscription updated";
                            //}
                            notification.server.send(_sendUserId, _receiverUserId, _fullname, _notification, _header,'');
                            closebox('gig_subscription_id');
                            openbox(1, 'Subscription_placed_id');
                        },
                        error: function (jqXHR, exception) {
                            $("#loaderDiv").hide();
                            console.log(jqXHR.status);
                            console.log(exception);
                        }
                    });

                }

</script>
@using (Html.BeginForm("SaveGigSubscription", "Gigs", null, FormMethod.Post, new { @id = "FormSubscription" }))
{

    <div class="largebox_content_containerbg" id="detail_div">
        <div class="">

            <div id="loaderDiv" class="loaderDivclass " style="display:none"></div>
            <div class="container_inner middile_con_inner_bg clearfix">

                <div class="col-md-12 catagory_con_top_bg clearfix">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="pull-left">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="@Url.Action("Home", "Dashboard")">MatchBX</a></li>
                                    <li class="breadcrumb-item" id="category"></li>
                                    <li class="breadcrumb-item active">@Model.GigTitle</li>
                                </ol>
                            </div>

                        </div>
                        <div class="col-md-4">
                            &nbsp;
                        </div>
                    </div><!--row-->
                </div>
                <!-- // catagory_con_top_bg-->


                <div class="col-md-12 con_8_4_outer_bg clearfix">
                    <div class="row con_row">
                        @if (Model.GigId > 0)
                        {
                            <div class="col-md-8 home_left_8">

                                <div class="col-md-12 home_user_box_1_bg bg_color_comen padd_left_right_o clearfix">
                                    <div class="box_paddleftright_15 clearfix">
                                        @Html.Hidden("hdnGigId", Model.GigId, new { @id = "hdnGigId" })
                                        <h3>@Model.GigTitle</h3>
                                        <input type="hidden" id="hdngigtitle" value="@Model.GigTitle" />
                                        <input type="hidden" id="hdnseekerid" value="@Model.UserId" />
                                        <div class="timeframe_budget_small clearfix">
                                            @if (Model.GigDuration > 1)
                                            {
                                                <div class="timeframe_only"><span>Duration: </span>&nbsp;<span>@Model.GigDuration Days</span></div>
                                            }
                                            else
                                            {
                                                <div class="timeframe_only"><span>Duration: </span>&nbsp;<span>@Model.GigDuration Days</span></div>
                                            }
                                            @*<div class="timeframe_only posted_day">
                        <span>Posted: </span>&nbsp;
                        <span>@Model.PostedDays</span>
                        @if (Model.PostedDays > 1)
                        { <span> days ago</span>}
                        else
                        { <span> day ago</span>}
                    </div>*@
                                            <div class="timeframe_only"><span>Purchased: </span>&nbsp;<span>@Model.GigsCompleted Times</span></div>
                                            <div class="budget_only"><span>Cost: </span>&nbsp;<span>@String.Concat(Model.BudgetASP.ToString("#,##0.00"), " AXPR ", "($", (Math.Round(Model.DollarCount, 2)).ToString("#,##0.00"), ")")</span></div>
                                            <div class="axp_star_only">
                                                <ul>
                                                    @if (Model.BadgeCount == 1)
                                                    {
                                                        <li><i></i></li>
                                                    }
                                                    else if (Model.BadgeCount == 2)
                                                    {
                                                        <li><i></i></li>
                                                        <li><i></i></li>
                                                    }
                                                    else if (Model.BadgeCount == 3)
                                                    {
                                                        <li><i></i></li>
                                                        <li><i></i></li>
                                                        <li><i></i></li>
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div><!--box_paddleftright_15-->
                                    <div class="border_buttom_only job_details_linewithspace"></div>
                                    <div class="box_paddleftright_15 clearfix">
                                        <div class="home_client_discription_small clearfix">

                                            <h3 class="gig_dis_h3">
                                                <span>About this service </span>
                                            </h3>
                                            <p>@Model.GigDescription</p>

                                            <div class="gig_deliverable_box">
                                                <div class="gig_deliverable_box_inn clearfix">
                                                    <h3 class="">What will you get by purchasing this service</h3>
                                                    <p>@Model.Deliverables</p>
                                                </div>
                                            </div>

                                            <h5 class="job_skill_textshow">
                                                <span>SKILL SET: </span>
                                                @foreach (var item in Model.GigSkillsMappingList)
                                                {
                                                    <span>
                                                        @if (Model.GigSkillsMappingList.IndexOf(item) == Model.GigSkillsMappingList.Count - 1)
                                                        {
                                                            @item.Description
                                                        }
                                                        else
                                                        {
                                                            @item.Description<span>, </span>
                                                        }
                                                    </span>
                                                }
                                            </h5>



                                            <div class="job_tags_textshow" id="detailTagList">
                                                <div class="home_trending_tags clearfix">
                                                    <span class="job_tags_textlabel">Tags:</span>
                                                    @foreach (var item in Model.GigTrendingTagsMappingList)
                                                    {
                                                        if (Model.GigTrendingTagsMappingList.IndexOf(item) == Model.GigTrendingTagsMappingList.Count - 1)
                                                        {
                                                            @item.Description
                                                        }
                                                        else
                                                        {
                                                            @item.Description<span>, </span>
                                                        }
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div><!--box_paddleftright_15-->
                                    <div class="border_buttom_only job_details_linewithspace"></div>
                                    <div class="box_paddleftright_15 clearfix">
                                        <div class="client_profile_imgname_bg clearfix">
                                            <div class="pull-left">
                                                <div class="client_profile_pic">
                                                    <div class="client_profile_pic_1">
                                                        <img src="@Model.ProfilePic" alt="">
                                                    </div>
                                                    <i class="profile_pic_star"></i>
                                                </div>
                                                <div class="client_profile_name">
                                                    <a href="@Url.Action("Index", "Profile", new { @id = @Model.UserId })">
                                                        <h4>@Model.FullName</h4>
                                                    </a>
                                                    <input type="hidden" id="hdnuserid" value="@Model.UserId" />
                                                    <span>@Model.JobsCompleted jobs completed</span>
                                                </div>
                                            </div><!--pull-left-->
                                            <div class="pull-right text-right">
                                                <div class="company_profile_refedit">
                                                    @*<div><span>Job reference:&nbsp;</span><span>@Model.JobReferanceId</span></div>*@
                                                    @*<div><span>Last edited:&nbsp;</span><span>@Model.LastEdited</span></div>*@
                                                    <div class="profile_public_banner_rate_only">
                                                        <span class="">RATING (@TempData["RatingCount"])</span>
                                                        <ul class="clearfix">
                                                            @if (TempData["RatingWhole"].ToString() == "1")
                                                            {
                                                                if (TempData["RatingFraction"].ToString() == "5")
                                                                {
                                                                    <li><i></i></li>
                                                                    <li class="half_star"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }
                                                                else
                                                                {
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }

                                                            }
                                                            else if (TempData["RatingWhole"].ToString() == "2")
                                                            {
                                                                if (TempData["RatingFraction"].ToString() == "5")
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="half_star"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>

                                                                }
                                                                else
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }
                                                            }
                                                            else if (TempData["RatingWhole"].ToString() == "3")
                                                            {
                                                                if (TempData["RatingFraction"].ToString() == "5")
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="half_star"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>

                                                                }
                                                                else
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }
                                                            }
                                                            else if (TempData["RatingWhole"].ToString() == "4")
                                                            {
                                                                if (TempData["RatingFraction"].ToString() == "5")
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="half_star"><i></i></li>


                                                                }
                                                                else
                                                                {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }
                                                            }
                                                            else if (TempData["RatingWhole"].ToString() == "5")
                                                            {
                                                                <li><i></i></li>
                                                                <li><i></i></li>
                                                                <li><i></i></li>
                                                                <li><i></i></li>
                                                                <li><i></i></li>
                                                            }
                                                            else if (TempData["RatingWhole"].ToString() == "0")
                                                            {
                                                                if (TempData["RatingFraction"].ToString() == "5")
                                                                {
                                                                    <li class="half_star"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>


                                                                }
                                                                else
                                                                {
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                }
                                                            }

                                                        </ul>

                                                    </div>
                                                </div>
                                            </div><!--pull-right-->
                                        </div>
                                    </div><!--box_paddleftright_15-->
                                    @if (Model.GigSubscriptionList != null && Model.GigSubscriptionList.Count > 0)
                                    {
                                        var first = Model.GigSubscriptionList.First();
                                        <div class="border_buttom_only" id="bottom_Offer"></div>
                                        <div class="dash_timeremain_corrent_offer_box_bg clearfix">
                                            <h4 class="dash_time_corrent_offh3 clearfix">CURRENT OFFERS</h4>
                                            @foreach (var sub in Model.GigSubscriptionList)
                                            {
                                                if (sub.GigSubscriptionId != first.GigSubscriptionId)
                                                {
                                                    <div id="border_buttom_@sub.GigSubscriptionId" class="col-md-12 border_buttom_only job_details_linewithspace padd_left_right_o"></div>
                                                }
                                                <div id="div_offers_accept_@sub.GigSubscriptionId" class="col-md-12 padd_left_right_o dash_time_corrent_off_proilebox clearfix div_offers">
                                                    <div class="pull-left">
                                                        <div class="client_profile_imgname_bg client_profile_imgname_bg_inline clearfix">
                                                            <div class="client_profile_pic">
                                                                <div class="client_profile_pic_1">
                                                                    <img src="@Url.Content("~/" + sub.PosterProfilePic.ToString().Replace("..", ""))" alt="">
                                                                </div>
                                                                <i class="profile_pic_star"></i>
                                                            </div>
                                                            <a href="@Url.Action("Index", "Profile",new { @id= sub.JobPosterId })">
                                                                <div class="client_profile_name">
                                                                    <h4>@sub.PosterFullName</h4>
                                                                    <span>@sub.JobsCompleted jobs completed</span>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div class="pull-right dash_time_allmenus">
                                                        @*<a href="#" onclick="LoadMessages('GigsRequest',@sub.JobPosterId,'@sub.PosterFullName','',@sub.GigId,'@Model.GigTitle')" class="dash_time_right_menu">Send message</a>*@
                                                        <a href="#" id="btnDecline" class="dash_time_right_menu decenabled" title="Decline offer">Decline</a>
                                                        <a href="#" id="btnAccept" class="btn button_all secondary_color_bg acptenabled">Accept</a>

                                                        <input type="hidden" id="hfGigSubId_@sub.GigSubscriptionId" value="@sub.GigSubscriptionId">
                                                        <input type="hidden" id="hfGigId_@sub.GigId" value="@sub.GigId">
                                                        <input type="hidden" id="hfReqName_@sub.PosterFullName" value="@sub.PosterFullName">
                                                        <input type="hidden" id="hfReqId_@sub.JobPosterId" value="@sub.JobPosterId">
                                                    </div>
                                                    <div class="col-md-12 col-xs-12 padd_left_right_o dash_time_corrent_off_message clearfix">
                                                        <div class="timeframe_budget_small clearfix">
                                                            <div class="timeframe_only">
                                                                <span class="dash_time_span_label">Purchased on: @sub.SubscribedDateDisplay</span>&nbsp;&nbsp;
                                                                <span class="dash_time_span_label">Job completion date: @sub.JobCompletionDateDisplay</span>
                                                            </div>
                                                        </div>
                                                        <h4 class="gig_sub_titleh4">@sub.Title</h4>
                                                        <div class="readmoretext comment more clearfix">
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                html = sub.Description.Substring(0, 100);
                                                                h = sub.Description.Substring(100 - 1, sub.Description.Length - 100);
                                                            }
                                                            else
                                                            {
                                                                html = sub.Description;
                                                            }

                                                            @html
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                <span class="moreellipses">...&nbsp;</span>
                                                                <span class="morecontent"><span>@h</span>&nbsp;&nbsp;<a href="#" class="morelink">Read More</a></span>
                                                            }
                                                        </div>
                                                        <div class="coment_readmore_bgg">
                                                            <input type="hidden" id="hfbidmessage_@sub.Description" value="@sub.Description">
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    }
                                    @if (Model.GigActiveOrdersList != null && Model.GigActiveOrdersList.Count > 0)
                                    {
                                        var first = Model.GigActiveOrdersList.First();
                                        <div class="border_buttom_only"></div>
                                        <div class="dash_timeremain_corrent_offer_box_bg clearfix">
                                            <h4 class="dash_time_corrent_offh3 clearfix">Active Orders</h4>
                                            @foreach (var sub in Model.GigActiveOrdersList)
                                            {
                                                if (sub.GigSubscriptionId != first.GigSubscriptionId)
                                                {
                                                    <div id="border_buttom_@sub.GigSubscriptionId" class="col-md-12 padd_left_right_o border_buttom_only job_details_linewithspace"></div>
                                                }
                                                <div id="div_offers_accept_@sub.GigSubscriptionId" class="col-md-12 padd_left_right_o dash_time_corrent_off_proilebox clearfix">
                                                    <div class="pull-left">
                                                        <div class="client_profile_imgname_bg client_profile_imgname_bg_inline clearfix">
                                                            <div class="client_profile_pic">
                                                                <div class="client_profile_pic_1"> <img src="@Url.Content("~/" + sub.PosterProfilePic.ToString().Replace("..", ""))" alt=""> </div>
                                                                <i class="profile_pic_star"></i>
                                                            </div>
                                                            <a href="@Url.Action("Index", "Profile",new { @id= sub.JobPosterId })">
                                                                <div class="client_profile_name">
                                                                    <h4>@sub.PosterFullName</h4>
                                                                    <span>@sub.JobsCompleted jobs completed</span>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div class="pull-right dash_time_allmenus">
                                                        @if (sub.JobId != 0)
                                                        {
                                                            <a href="#" onclick="LoadMessages('GigsRequest',@Html.Raw(Json.Encode(Session["UserId"])),'@sub.PosterFullName','',@sub.JobId,'@sub.Title',@sub.JobPosterId)" class="dash_time_right_menu">Send message</a>
                                                        }
                                                        @if (sub.GigSubscriptionStatus == "J" && sub.JobStatus == "A" && sub.JobStatusSeeker != "C")
                                                        {
                                                            <a href="#" id="btnComplete" class="dash_time_right_menu decenabled" title="Mark as Complete">Mark as Complete</a>
                                                        }
                                                        else if (sub.GigSubscriptionStatus == "A")
                                                        {
                                                            <a href="#" id="btnCancel" class="dash_time_right_menu decenabled" title="Cancel Order">Cancel Order</a>
                                                        }
                                                        <input type="hidden" id="hfJobId_@sub.JobId" value="@sub.JobId">
                                                        <input type="hidden" id="hfJobPosterId_@sub.JobId" value="@sub.JobPosterId">
                                                        <input type="hidden" id="hfJobtitle_@sub.JobId" value="@sub.Title">
                                                        <input type="hidden" id="hfUserRole_@sub.JobId" value="S">
                                                        <input type="hidden" id="hfSeekerName_@sub.JobId" value="@Session["FullName"].ToString()">
                                                        <input type="hidden" id="hfPostername_@sub.JobId" value="@sub.PosterFullName">
                                                        <input type="hidden" id="hfSeekerId_@sub.JobId" value="@Session["UserId"].ToString()" />
                                                        <input type="hidden" id="hfGigId_@sub.JobId" value="@sub.GigId">
                                                        <input type="hidden" id="hfGigSubId_@sub.JobId" value="@sub.GigSubscriptionId">
                                                    </div>
                                                    <div class="col-md-12 col-xs-12 padd_left_right_o dash_time_corrent_off_message clearfix">
                                                        <div class="timeframe_budget_small clearfix">
                                                            <div class="timeframe_only"> <span class="dash_time_span_label">Purchase Date: @sub.PurchasedDateDisplay</span>&nbsp;&nbsp; <span class="dash_time_span_label">Delivery Deadline: @sub.JobCompletionDateDisplay</span> </div>
                                                        </div>
                                                        <h4 class="gig_sub_titleh4">@sub.Title</h4>
                                                        <div class="readmoretext comment more clearfix">
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                html = sub.Description.Substring(0, 100);
                                                                h = sub.Description.Substring(100 - 1, sub.Description.Length - 100);
                                                            }
                                                            else
                                                            {
                                                                html = sub.Description;
                                                            }

                                                            @html
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                <span class="moreellipses">...&nbsp;</span>
                                                                <span class="morecontent"><span>@h</span>&nbsp;&nbsp;<a href="#" class="morelink">Read More</a></span>
                                                            }
                                                        </div>
                                                        <div class="coment_readmore_bgg">
                                                            <input type="hidden" id="hfbidmessage_@sub.Description" value="@sub.Description">
                                                        </div>
                                                        <div class="gig_dash_mygig_bu padd_top_10px clearfix">
                                                            <div class="pull-left gig_dash_admin_pendingbg">
                                                                @if (sub.GigSubscriptionStatus == "J" && sub.JobStatus == "A" && sub.JobStatusSeeker != "C")
                                                                {
                                                                    <div class="pending_box_alert progress_alert">In progress</div>
                                                                }
                                                                else if (sub.GigSubscriptionStatus == "A")
                                                                {
                                                                    <div class="pending_box_alert panding_alert">Pending Payment</div>
                                                                }
                                                                else if (sub.GigSubscriptionStatus == "J" && sub.JobStatus == "A" && sub.JobStatusSeeker == "C")
                                                                {
                                                                    <div class="pending_box_alert panding_alert">Pending Client Review</div>
                                                                }
                                                            </div>
                                                            <div class="pull-right dash_time_allmenus"> </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            <input type="hidden" id="hfjobtitle" />
                                            <input type="hidden" id="hfuserid" />
                                            <input type="hidden" id="hfrole" />
                                            <input type="hidden" id="hfseekername" />
                                            <input type="hidden" id="hfpostername" />
                                            <input type="hidden" id="hfseekerId" />
                                            <input type="hidden" id="hfgigSubId" />
                                        </div>
                                    }
                                    @if (Model.GigCompletedOrdersList != null && Model.GigCompletedOrdersList.Count > 0)
                                    {
                                        var first = Model.GigCompletedOrdersList.First();
                                        <div class="border_buttom_only"></div>
                                        <div class="dash_timeremain_corrent_offer_box_bg clearfix">
                                            <h4 class="dash_time_corrent_offh3 clearfix">Completed Orders</h4>
                                            @foreach (var sub in Model.GigCompletedOrdersList)
                                            {
                                                if (sub.GigSubscriptionId != first.GigSubscriptionId)
                                                {
                                                    <div id="border_buttom_@sub.GigSubscriptionId" class="col-md-12 padd_left_right_o border_buttom_only job_details_linewithspace"></div>
                                                }
                                                <div id="div_offers_accept_@sub.GigSubscriptionId" class="col-md-12 padd_left_right_o dash_time_corrent_off_proilebox clearfix">
                                                    <div class="pull-left">
                                                        <div class="client_profile_imgname_bg client_profile_imgname_bg_inline clearfix">
                                                            <div class="client_profile_pic">
                                                                <div class="client_profile_pic_1"> <img src="@Url.Content("~/" + sub.PosterProfilePic.ToString().Replace("..", ""))" alt=""> </div>
                                                                <i class="profile_pic_star"></i>
                                                            </div>
                                                            <a href="/Profile/Index/107">
                                                                <div class="client_profile_name">
                                                                    <h4>@sub.PosterFullName</h4>
                                                                    <span>@sub.JobsCompleted jobs completed</span>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    @*<div class="pull-right dash_time_allmenus">
                                                        <a href="#" onclick="LoadMessages('GigsRequest',@sub.JobPosterId,'@sub.PosterFullName','',@sub.GigId)" class="dash_time_right_menu">Send message</a>
                                                        @if (sub.GigSubscriptionStatus == "J" && sub.JobStatus == "A")
                                                        {
                                                            <a href="#" id="btnComplete" class="dash_time_right_menu decenabled" title="Mark as Complete">Mark as Complete</a>
                                                        }
                                                        else if (sub.GigSubscriptionStatus == "A")
                                                        {
                                                            <a href="#" id="btnCancel" class="dash_time_right_menu decenabled" title="Cancel Order">Cancel Order</a>
                                                        }
                                                        <input type="hidden" id="hfJobId_@sub.JobId" value="@sub.JobId">
                                                        <input type="hidden" id="hfJobPosterId_@sub.JobId" value="@sub.JobPosterId">
                                                        <input type="hidden" id="hfJobtitle_@sub.JobId" value="@sub.Title">
                                                        <input type="hidden" id="hfUserRole_@sub.JobId" value="S">
                                                        <input type="hidden" id="hfSeekerName_@sub.JobId" value="@Session["FullName"].ToString()">
                                                        <input type="hidden" id="hfPostername_@sub.JobId" value="@sub.PosterFullName">
                                                        <input type="hidden" id="hfSeekerId_@sub.JobId" value="@Session["UserId"].ToString()" />
                                                        <input type="hidden" id="hfGigId_@sub.JobId" value="@sub.GigId">
                                                        <input type="hidden" id="hfGigSubId_@sub.JobId" value="@sub.GigSubscriptionId">
                                                    </div>*@
                                                    <div class="col-md-12 col-xs-12 padd_left_right_o dash_time_corrent_off_message clearfix">
                                                        <div class="timeframe_budget_small clearfix">
                                                            <div class="timeframe_only"> <span class="dash_time_span_label">Purchase Date: @sub.PurchasedDateDisplay</span>&nbsp;&nbsp; <span class="dash_time_span_label">Completed Date: @sub.JobCompletionDateDisplay</span> </div>
                                                        </div>
                                                        <h4 class="gig_sub_titleh4">@sub.Title</h4>
                                                        <div class="readmoretext comment more clearfix">
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                html = sub.Description.Substring(0, 100);
                                                                h = sub.Description.Substring(100 - 1, sub.Description.Length - 100);
                                                            }
                                                            else
                                                            {
                                                                html = sub.Description;
                                                            }

                                                            @html
                                                            @if (sub.Description.Length > 100)
                                                            {
                                                                <span class="moreellipses">...&nbsp;</span>
                                                                <span class="morecontent"><span>@h</span>&nbsp;&nbsp;<a href="#" class="morelink">Read More</a></span>
                                                            }
                                                        </div>
                                                        <div class="coment_readmore_bgg">
                                                            <input type="hidden" id="hfbidmessage_@sub.Description" value="@sub.Description">
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                                <!-- // box-->
                                <!--Review section-->
                                <div class="col-md-12 gig_review_view_outer">
                                    <div class="col-md-12 home_user_box_1_bg bg_color_comen padd_left_right_o clearfix">
                                        <div class="box_paddleftright_15 gig_review_view_mainheading clearfix">
                                            <a href="javascript:;" class="gig_review_slidebu clearfix" title="View Review">
                                                <h4>Review (@Html.Raw(Json.Encode(TempData["ReviewCount"])))</h4>
                                                <i class="down-arrow"></i>
                                            </a>
                                        </div>

                                        <div id="divjobs" class="gig_review_all_bg clearfix">
                                            <div class="border_buttom_only job_details_linewithspace"></div>
                                            @foreach (var item in Model.GigReviewList)
                                        {
                                    <div class="box_paddleftright_15 clearfix">
                                        <div class="client_profile_imgname_bg clearfix">
                                            <div class="pull-left">
                                                <div class="client_profile_pic">
                                                    <div class="client_profile_pic_1">
                                                        <img src="@item.ProfilePic" alt="">
                                                    </div>
                                                    <i class="profile_pic_star"></i>
                                                </div>
                                                <div class="client_profile_name">
                                                    <a href="javascript:;">
                                                        <h4>@item.FullName</h4>
                                                    </a>
                                                    <span>@item.CreatedDateDisplay</span>
                                                </div>
                                            </div><!--pull-left-->
                                            <div class="pull-right text-right">
                                                <div class="company_profile_refedit">
                                                    <input type="hidden" id="hfgigreviewid_@item.GigReviewId" value="@item.GigReviewId" />
                                                    <div class="profile_public_banner_rate_only">
                                                        <ul class="clearfix">
                                                            @if (item.JobSeekerRatingInt == 1)
                                                                    {
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    }
                                                                    else if (item.JobSeekerRatingInt == 2)
                                                                    {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    }
                                                                    else if (item.JobSeekerRatingInt == 3)
                                                                    {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    }
                                                                    else if (item.JobSeekerRatingInt == 4)
                                                                    {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li class="star_gray"><i></i></li>
                                                                    }
                                                                    else if (item.JobSeekerRatingInt == 5)
                                                                    {
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    <li><i></i></li>
                                                                    }

                                                        </ul>

                                                    </div>
                                                </div>
                                            </div><!--pull-right-->
                                        </div>
                                        <div class="col-md-12 home_client_discription_small clearfix">
                                            <div class="readmoretext more">@item.Review</div>

                                        </div>
                                    </div><!--box_paddleftright_15-->
                                        }
                                            <div id="loadMore">
                                                @if (Model.GigReviewList != null && Model.GigReviewList.Count > 0 && Model.GigReviewList[0].Isloadmore == 1)
                                            {
                                            <div class="col-md-12 category_loadmore_bg clearfix" id="divloadmore">
                                                <a href="javascript:;" class="btn button_all secondary_color_bg" id="btnloadmore">Load more</a>
                                            </div>
                                            }
                                            </div>
                                        </div><!--gig_review_all_bg-->
                                    </div>

                                </div>
                            </div><!-- //col-md-8-->
                        }


                        @if ((Convert.ToInt32(Session["UserId"]) != Model.UserId) && (Convert.ToInt32(Session["UserId"]) != 0))
                        {
                            //if ((Session["UserType"].ToString() != "1"))
                            //{
                            <div class="col-md-4 job_detail_right_4">

                                <div class="col-md-12 bg_color_comen home_top_jobs_bg job_detail_right_bg clearfix">
                                    <div class="home_top_jobs_heding heading_border_buttom">
                                        <h2 id="headbid"></h2>
                                        @Html.Hidden("hdnGigSubscriptionId", @TempData["GigSubscriptionId"], new { @id = "hdnGigSubscriptionId" })
                                    </div>

                                    <div class="job_detail_bidforjob_form_bg clearfix">
                                        <div class="form-group clearfix">
                                            <label for="" class="input_label_style">Give your job a title </label>
                                            @Html.TextBox("GigTitle", TempData["GigTitle"].ToString(), new { @class = "form-control form_input form_textarea", @name = "GigTitle", @maxlength = "200" })
                                        </div>


                                        <div class="form-group clearfix">
                                            <label for="" class="input_label_style">Tell us what you are looking for </label>
                                            @Html.TextArea("bidmessage", TempData["BidMessage"].ToString(), new { @class = "form-control form_input form_textarea", @name = "bidmessage" })
                                        </div>
                                        <div class="form-group clearfix">
                                            <label for="" class="input_label_style">Project documents</label>

                                            <div class="demo_container dropzone_bg">
                                                <div class="dropzone" id="my-dropzone"></div>

                                            </div>
                                            @if (Convert.ToInt32(TempData["NoofDocuments"]) > 0)
                                            {
                                                <div class="home_trending_tags job_review_attach clearfix attachments" id="divviewattachment">
                                                    <a href="#" title="View Attachment" id="view_attachment"><span class="job_tags_textlabel">View Attachment</span></a>
                                                </div>
                                            }
                                        </div>

                                        <div class="form-group clearfix">
                                            <label for="" class="input_label_style">When do you need the job completed by? </label>
                                            <div class='date' id='sandbox-container'>
                                                @Html.TextBox("GigCompletionDate", TempData["JobCompletionDateDisplay"], new { @id = "jobcompletionDate", @placeholder = "Enter date", @class = "form-control form_input ", autocomplete = "off", @name = "GigCompletionDate" })
                                            </div>
                                            @*@Html.ValidationMessageFor("GigCompletionDate", "", new { @class = "error_span" })*@
                                        </div>
                                        <div class="form-group heading_border_buttom clearfix">
                                            <label for="" class="input_label_style"><span>Service Fees: (</span><span id="BidAmountinDollar">@TempData["GigAmount"]</span><span>)</span></label>

                                            @Html.TextBox("bidamount", "$ " + @TempData["BidAmountinDollar"], new { @readonly = "readonly", @class = "form-control form_input " })

                                            <span id="errorMsg" class="error_span"></span>
                                            <label class="input_label_style display_block small_fobtsize"><span id="axprfee" class="font_w_700">@TempData["AXPRFeeAmt"]</span><span> AXPR is taken from this and burnt (3% burn)</span></label>
                                            <label class="input_label_style display_block"><span class="add_job_cost">Your service will cost: <span id="IdtotalBudget" class="font_w_700">@TempData["AXPRFeeTotAmt"]</span> AXPR</span></label>
                                        </div>
                                        <div class="form-group clearfix">
                                            @*<a href="#header" class="btn btn_banner secondary_color_bg button_fluid smothscroll" id="btnsubscribe"></a>*@
                                            @if (TempData["GigSubscriptionStatus"].ToString() == "S")
                                            {
                                                <input type="submit" class="btn btn_banner secondary_color_bg button_fluid button_width100 smothscroll" id="btnsubscribe" />
                                            }                                            
                                        </div>
                                    </div>
                                </div>
                                <!-- // Top job posters section-->
                            </div><!-- //col-md-4-->
                            //}

                        }

                    </div><!-- //row-->
                </div>
            </div>
            <!--container_inner -->
        </div>
        <!--/#container-->
    </div>

    <div id="shadowing" class="shadowing_overlay myshadow"></div>

    <div id="gig_subscription_id" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix"><span id="span_sub_tit"></span><a href="#" class="popup_close_bg" title="Close" onclick="closebox('gig_subscription_id')"></a> </span>@*@Url.Action("Details", "Jobs", new { @id = @Session["JobId"] })*@
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style"><span id="span_sub_tit_msg"></span><span id="span_gig_subs"></span></label>
                <a href="#" id="btnConfirmGig" class="btn btn_banner secondary_color_bg maxwidth325" title="Yes, Place Order">Yes, Place Order</a>
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                @*<p><a href="#" onclick="closebox('gig_subscription_id')">NO, CANCEL OFFER</a></p>*@@*@Url.Action("Details", "Jobs",new { @id = @Session["JobId"]})*@
                <p><a href="@Url.Action("Details", "Gigs",new { @id = @Session["GigId"],@subid = @Session["SubGigId"]})">NO, CANCEL ORDER</a></p>
            </div>
        </div>
    </div>

    <div id="Subscription_placed_id" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix">
            <span id="spnOffer">Order placed!</span>
            <a href="@Url.Action("Details", "Gigs", new { @id = @Session["GigId"] })" class="popup_close_bg" title="Close"></a>
        </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style"><span id="spnCongrats">Congrats! You just placed an order for the service: </span>"@Model.GigTitle"</label>
                <a href="@Url.Action("Search", "Gigs", null)" class="btn btn_banner secondary_color_bg maxwidth325" title="Search for another service">Search for another service</a>
            </div>
            @*<div class="form-group register_small_already_reg delete_job_link clearfix">
                    <p><a href="@Url.Action("Details", "Jobs",new { @id = @Session["JobId"]})">VIEW AND EDIT OFFER</a></p>
                </div>*@
        </div>
    </div>

    <div id="metamask_comfirmation_id_gig" class="popup_box clearfix myshadow">
        <span id="" class="col-md-12 popup_box_title clearfix"> Set Up metamask <a href="#" onclick="closebox('metamask_comfirmation_id_gig')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style">To use MatchBX you need to install and run MetaMask. <br /></label>
                <ol class="metamask_infoul text-left">
                    <li style="">Download MetaMask from MetaMask <a target="_blank" class="blue_color_text" href="https://metamask.io/">website</a></li>
                    <li>Make sure your MetaMask is linked to your AXPR wallet address when using MatchBX</li>
                    <li>Get started on MatchBX</li>
                </ol>
                <a href="https://metamask.io/" target="_blank" onclick="closebox('metamask_comfirmation_id_gig')" class="btn btn_banner secondary_color_bg maxwidth325" title="Set Up MetaMask">Set Up MetaMask</a>
            </div>
        </div>
    </div>

    <div id="attachement_pop_id" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix"> Attachment <a href="#" onClick="closebox('attachement_pop_id')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg">
            <div class="form-group clearfix">
                <div class="home_trending_tags job_review_attach clearfix">
                    <ul id="view_attachment_ul"></ul>
                </div>
            </div>

            <div class="form-group clearfix">

                <a href="#" onClick="closebox('attachement_pop_id')" class="btn btn-default register_small_button secondary_color_bg" title="Close">Close</a>
            </div>
        </div>
    </div>




    <div id="gig_subscriptiondocdelete" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix"> Attachment <a href="#" class="popup_close_bg" title="Close" onclick="closebox('gig_subscriptiondocdelete')"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style">Are you sure you want to delete this document?</label>
                <a href="#" id="btnConfirmDeletion" onclick="removeDoc()" class="btn btn_banner secondary_color_bg maxwidth325" title="Yes Delete">Yes Delete</a>
                <input type="hidden" id="hdndelconfirmdocid" />
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                <p><a href="#" onclick="cancelDel()">NO, CANCEL</a></p>
            </div>
        </div>
    </div>

    <div id="gigAccept_pop" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix"><span id="gigAccept_title"></span><a href="#" onclick="closebox('gigAccept_pop')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style" id="gigAccept_msg">
                </label>
                <a href="#" id="gigAcceptOk" class="btn btn_banner secondary_color_bg maxwidth325" title="Okay">Ok</a>
                <a href="#" id="gigDeclineOk" class="btn btn_banner secondary_color_bg maxwidth325" title="Okay">Ok</a>
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                <a href="#" onclick="closebox('gigAccept_pop')" title="Cancel">Cancel</a>
            </div>
        </div>
    </div>

    <div id="gigRequest_pop" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix"><span id="gigRequest_title"></span><a href="#" onclick="closebox('gigRequest_pop')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style" id="gigRequest_msg">
                </label>
                <a href="#" id="gigRequestOk" class="btn btn_banner secondary_color_bg maxwidth325" title="Okay">Ok</a>
            </div>
        </div>
    </div>

    <div id="mark_complete_confirmation_pop_id" class="popup_box clearfix myshadow">
        <span id="" class="col-md-12 popup_box_title clearfix"> Job completion confirmation<a href="#" onClick=" closebox('mark_complete_confirmation_pop_id')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style">Are you sure you want to mark the job <span id="spnJobTitle"></span> as complete?<a href="#" onClick=" closebox('mark_complete_confirmation_pop_id')" class="popup_close_bg" title="Close"></a> </label>
                <input type="hidden" id="hfjobid" value="" />
                <input type="hidden" id="hfuserrole" value="" />
            </div>
            <div class="form-group clearfix">
                <a href="#" id="btnyes1" class="btn btn_banner secondary_color_bg maxwidth325">Yes mark as complete </a>
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                <p><a href="#" onClick="closebox('mark_complete_confirmation_pop_id')" id="btncancel">NO, CANCEL MARKING AS COMPLETE </a></p>
            </div>
        </div>
    </div>

    <div id="mark_complete_rating_pop_id" class="popup_box clearfix myshadow">
        @*<a href="#" onClick="closebox('mark_complete_rating_pop_id')" class="popup_close_bg" title="Close"></a>*@
        <a href="#" class="popup_close_bg" title="Close" id="popupReview"></a>
        <span id="spanrole" class="col-md-12 popup_box_title clearfix">
            Review job poster
            @*<a href="#" onClick="closebox('mark_complete_rating_pop_id')" class="popup_close_bg" title="Close"></a>*@
        </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style">How would you rate <span class="blue_color_text" id="spname"></span> ?</label>
                <input type="hidden" id="hfjobid" value="" />
                <input type="hidden" id="hfuserrole" value="" />
            </div>
            <div class="form-group clearfix">
                <!--Rating star bg-->
                <div class="star-rating">
                    <span class="fa fa-star fa_star_gray" data-rating="1"></span>
                    <span class="fa fa-star fa_star_gray" data-rating="2"></span>
                    <span class="fa fa-star fa_star_gray" data-rating="3"></span>
                    <span class="fa fa-star fa_star_gray" data-rating="4"></span>
                    <span class="fa fa-star fa_star_gray" data-rating="5"></span>
                    <input type="hidden" name="whatever1" id="txtrating" class="rating-value" value="5">
                </div>
                <!-- //Rating star bg-->
            </div>
            <div class="form-group clearfix" id="divGigReview" style="display:none">
                <textarea class="form-control form_input form_textarea" id="txtgigReview" placeholder="How was your experience" maxlength="1000"></textarea>
            </div>
            <div class="form-group clearfix">
                <a href="#" id="btnGigrvwSub" class="btn btn-default register_small_button secondary_color_bg" title="">SUBMIT</a>
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                <p><a href="#" id="dontReview">I DONʼT WANT TO LEAVE A REVIEW</a></p>
            </div>
        </div>
    </div>

    <div id="gigSubscriptionCancel_pop" class="popup_box clearfix myshadow popup_fixed_middle">
        <span id="" class="col-md-12 popup_box_title clearfix">Cancel Order<a href="#" onclick="closebox('gigSubscriptionCancel_pop')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style" id="gigRequest_msg">
                    Do you want to cancel the order?
                </label>
                <a href="#" id="gigCancelSubOk" class="btn btn_banner secondary_color_bg maxwidth325" title="Yes">Yes</a>
            </div>
            <div class="form-group register_small_already_reg delete_job_link clearfix">
                <a href="#" onclick="closebox('gigSubscriptionCancel_pop')" title="No">No</a>
            </div>
        </div>
    </div>

    <div id="gigSubscriptionCancelSuccess" class="popup_box popup_fixed_middle clearfix myshadow">
        <span id="" class="col-md-12 popup_box_title clearfix"> Service Order Cancelled <a href="#" onclick="closebox('gigSubscriptionCancelSuccess')" class="popup_close_bg" title="Close"></a> </span>
        <div class="col-md-12 pop_container_bg text-center">
            <div class="form-group clearfix">
                <label for="" class="input_label_style">Cancelled the service order successfully</label>
                <a href="#" id="gigSubCancel" class="btn btn_banner secondary_color_bg maxwidth325" title="Okay">OK</a>
            </div>
        </div>
    </div>
}
<script>
    (function() {

        $(".dropzone").dropzone({
            maxFiles: 3,
            url: '/Gigs/UploadSubscriptionDocuments',
            margin: 20,
            params:{
                'action': 'save'
            },
            init: function () {

                thisDropzone = this;
                var DocumentList = @Html.Raw(Json.Encode(Model.GigDocumentsList));
                $.each(DocumentList, function(i, item){
                    var mockFile = {
                        name: item.DocumentName,
                        accepted: true,
                        size:item.Filesize ,
                        kind: "*"
                    };
                    thisDropzone.emit("addedfile", mockFile);
                    thisDropzone.options.thumbnail.call(thisDropzone, mockFile, window.location.origin+'/Documents/'+item.name);
                    thisDropzone.emit("complete", mockFile);
                });
                this.on("maxfilesexceeded", function (data) {
                    var res = eval('(' + data.xhr.responseText + ')');

                });
                this.on("addedfile", function (file) {

                    // Create the remove button
                    var removeButton = Dropzone.createElement("<button class='file_remove_bu'><i class='fa fa-close'></i></button>");
                    // Capture the Dropzone instance as closure.
                    var _this = this;
                    // Listen to the click event
                    removeButton.addEventListener("click", function (e) {
                        // Make sure the button click doesn't submit the form:
                        e.preventDefault();
                        e.stopPropagation();
                        // Remove the file preview.
                        _this.removeFile(file);
                        // If you want to the delete the file on the server as well,
                        // you can do the AJAX request here.
                    });

                    // Add the button to the file preview element.
                    file.previewElement.appendChild(removeButton);
                });
                this.on()
            },
            success: function(res, index){
                console.log(res, index);
            }
        });

    }());

    var _Id, _SubId, _ReqUser, _ReqId, _UserId = "@Session["UserId"]", _UserName = "@Session["FullName"]", subscriptions = '@subscriptions', activeOrders = '@activeOrders';
    var notification = $.connection.notificationHub;

    $(document).ready(function () {
        var moretext = "Read More";
        var lesstext = "Read less";

        $("#detail_div").on("click", ".morelink", function () {
            if ($(this).hasClass("less")) {
                $(this).removeClass("less");
                $(this).html(moretext);
            } else {
                $(this).addClass("less");
                $(this).html(lesstext);
            }
            $(this).parent().prev().toggle();
            $(this).prev().toggle();
            return false;
        });

        $("#detail_div").on("click", "#btnDecline", function () {
            debugger
            _Id = $(this).parent().find('input[id^="hfGigId_"]').val();
            _SubId = $(this).parent().find('input[id^="hfGigSubId_"]').val();
            _ReqUser = $(this).parent().find('input[id^="hfReqName_"]').val();
            _ReqId = $(this).parent().find('input[id^="hfReqId_"]').val();
            $('#gigAccept_title').text('Decline service order');
            $('#gigAccept_msg').html('Do you want to decline this service purchase request?');
            $('#gigAcceptOk').hide();
            $('#gigDeclineOk').show();
            openbox(1, 'gigAccept_pop');
        });

        $("#detail_div").on("click", "#btnAccept", function () {
            _Id = $(this).parent().find('input[id^="hfGigId_"]').val();
            _SubId = $(this).parent().find('input[id^="hfGigSubId_"]').val();
            _ReqUser = $(this).parent().find('input[id^="hfReqName_"]').val();
            _ReqId = $(this).parent().find('input[id^="hfReqId_"]').val();
            $('#gigAccept_title').text('Accept service request');
            $('#gigAccept_msg').html('Do you want to accept this service purchase request?');
            $('#gigDeclineOk').hide();
            $('#gigAcceptOk').show();
            openbox(1, 'gigAccept_pop');
        });

        $("#detail_div").on("click", "#btnCancel", function () {
            _Id = $(this).parent().find('input[id^="hfGigId_"]').val();
            _SubId = $(this).parent().find('input[id^="hfGigSubId_"]').val();
            openbox(1, 'gigSubscriptionCancel_pop');
        });

        $("#gigCancelSubOk").click(function () {
            $.ajax({
                type: 'POST',
                cache: false,
                url: '@Url.Action("CancelSubscription", "Dashboard")',
                data: { 'gigId': _Id, 'subId': _SubId },
                success: function (response) {
                    closebox('gigSubscriptionCancel_pop');
                    //if(activeOrders == 1) {
                    //    $('#bottom_Offer').remove();
                    //    $('.dash_timeremain_corrent_offer_box_bg').remove();
                    //} else {
                    //    $('#border_buttom_' + _SubId).remove();
                    //    $('#div_offers_accept_' + _SubId).remove();
                    //}
                    //activeOrders--;
                    // window.location.reload();
                    openbox(1, 'gigSubscriptionCancelSuccess');
                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.status);
                    console.log(exception);
                }
            });
        });

        $('#gigSubCancel').click(function() {
            closebox('gigSubscriptionCancelSuccess');
            window.location.reload();
        });

        $("#detail_div").on("click", "#btnComplete", function () {
            var _jobid = $(this).parent().find('input[id^="hfJobId_"]').val();
            var _userid = $(this).parent().find('input[id^="hfJobPosterId_"]').val();
            var _jobtitle = $(this).parent().find('input[id^="hfJobtitle_"]').val();
            var _userrole = $(this).parent().find('input[id^="hfUserRole_"]').val();
            var _jobseekername = $(this).parent().find('input[id^="hfSeekerName_"]').val();
            var _jobpostername = $(this).parent().find('input[id^="hfPostername_"]').val();
            var _jobsekerId = $(this).parent().find('input[id^="hfSeekerId_"]').val();
            var _hfgigSubId = $(this).parent().find('input[id^="hfGigSubId_"]').val();

            _SubId = $(this).parent().find('input[id^="hfGigSubId_"]').val();

            debugger;
            $("#hfjobtitle").val(_jobtitle);
            $("#hfjobid").val(_jobid);
            $("#hfuserrole").val(_userrole);
            $("#hfuserid").val(_userid);
            $("#hfseekername").val(_jobseekername);
            $("#hfpostername").val(_jobpostername);
            $("#hfseekerId").val(_jobsekerId);
            $("#spnJobTitle").html(_jobtitle);
            $("#hfgigSubId").val(_hfgigSubId);
            openbox(1, 'mark_complete_confirmation_pop_id');
        });

        var $star_rating = $('.star-rating .fa');
        var SetRatingStar = function () {
            //
            return $star_rating.each(function () {
                if (parseInt($star_rating.siblings('input.rating-value').val()) >= parseInt($(this).data('rating'))) {
                    return $(this).removeClass('fa_star_gray').addClass('fa_star_active');
                } else {
                    return $(this).removeClass('fa_star_active').addClass('fa_star_gray');
                }

            });
            var _ratings = $("#txtrating").val();
            //alert(_ratings);
            RateJobs(_ratings)
        };

        $star_rating.on('click', function () {
            debugger;
            $star_rating.siblings('input.rating-value').val($(this).data('rating'));
            var _rating = $("#txtrating").val();
            var _jobid = $("#hfjobid").val();
            var _userrole = $("#hfuserrole").val();
            //RateJobs(_jobid, _rating, _userrole)
            return SetRatingStar();
        });

        $("#btnGigrvwSub").unbind("click").bind( "click",function()
        {
            debugger;
            var _rating = $("#txtrating").val();
            var _jobid = $("#hfjobid").val();
            var _userrole = $("#hfuserrole").val();
            RateJobs(_jobid, _rating, _userrole);
        });

        SetRatingStar();
        function RateJobs(jobid, ratings, userrole) {
            $.ajax({
                type: 'POST',
                cache: false,
                url: '@Url.Action("RateUser", "Dashboard")',
                data: { 'JobId': jobid, 'rating': ratings, 'UserRole': userrole },
                success: function (response) {
                    debugger;
                    if($("#hfgigSubId").val() > 0 && $("#hfuserrole").val() == "P" && $("#txtgigReview").val() != "")
                    {
                        var _GigReview = {
                            JobId:$("#hfjobid").val(),
                            Review: $("#txtgigReview").val(),
                            GigReviewStatus: 'R',
                            GigSubscriptionId: $("#hfgigSubId").val()
                        }
                        $.ajax({
                            type: 'POST',
                            cache:false,
                            contentType: 'application/json; charset=utf-8',
                            data: JSON.stringify({ GigReview: _GigReview }),
                            url: '@Url.Action("ReviewGig", "Dashboard")',
                            success: function (response) {
                                closebox('mark_complete_rating_pop_id');
                                window.location.reload();
                            }
                        });
                    }
                    else
                    {
                        closebox('mark_complete_rating_pop_id');
                        window.location.reload();
                    }

                },
                error: function (jqXHR, exception) {

                    console.log(jqXHR.status);
                    console.log(exception);
                }
            });
        }

        $("#popupReview").click(function () {
            closebox('mark_complete_rating_pop_id');
            window.location.reload();
        });

        $('#dontReview').click(function() {
            closebox('mark_complete_rating_pop_id');
            window.location.reload();
        });
    });

    function LoadMessages(_from, _prmSendUserId, _prmJobSeeker, _prmBidUserProfilePic, _prmJobId, _prmJobTitle, _prmReceiverId) {
        $.ajax({
            type: 'POST',
            cache: false,
            url: '@Url.Action("ChatForSendMessage", "Home")',
            data: { "_prmSendUserId": _prmSendUserId, "from": _from, "_prmJobSeeker": _prmJobSeeker, "_prmBidUserProfilePic": _prmBidUserProfilePic, "_prmJobID": _prmJobId, "_prmJobTitle": _prmJobTitle, "_prmReceiverId": _prmReceiverId },
            success: function (response) {
                $("#divChat").html(response);
                openbox(1, 'divChat');
            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.status);
                console.log(exception);
            }
        });
    }

    $.connection.hub.start().done(function () {
        $('#gigDeclineOk').on('click', function () {
            closebox('gigAccept_pop');
            // AcceptGigRequest(_Id, _SubId, _ReqUser, 'D');
            $.ajax({
                type: 'POST',
                cache: false,
                url: '@Url.Action("AcceptGigRequest", "Gigs")',
                data: { 'type': 'D', 'gigId': _Id, 'reqId': _SubId, "address": "" },
                beforeSend: function () {
                    $("#loaderDiv").show();
                },
                success: function (response) {
                    var _notification = "";
                    var _header = "";
                    var _Url = "";
                    if (response == "success") {
                        $("#loaderDiv").hide();
                        $('#gigRequest_title').text('Declined service request');
                        $('#gigRequest_msg').html('You have declined the service request from ' + _ReqUser);
                        _notification = _UserName + " has declined your service order"
                        _header = "Service order declined";
                        notification.server.send(_UserId, _ReqId, _ReqUser, _notification, _header, _Url);
                        //if(subscriptions == 1) {
                        //    $('#bottom_Offer').remove();
                        //    $('.dash_timeremain_corrent_offer_box_bg').remove();
                        //} else {
                        //    $('#border_buttom_' + _SubId).remove();
                        //    $('#div_offers_accept_' + _SubId).remove();
                        //}
                        //subscriptions--;
                        //window.location.reload();
                        openbox(1, 'gigRequest_pop');
                        //window.location.reload();
                    } else {
                        $("#loaderDiv").hide();
                        $('#gigRequest_title').text('Cannot complete operation');
                        $('#gigRequest_msg').text('Something went wrong. Please try again.');
                        openbox(1, 'gigRequest_pop');
                    }
                },
                error: function (jqXHR, exception) {
                    $("#loaderDiv").hide();
                    console.log(jqXHR.status);
                    console.log(exception);
                }
            });
        })

        $('#gigAcceptOk').on('click', function () {
            closebox('gigAccept_pop');
            AcceptGigRequest(_Id, _SubId, _ReqUser, 'A');
        })

        $('#gigRequestOk').on('click', function () {
            closebox('gigRequest_pop');
            // $('#gigsubrequest').trigger('click');
        })

        function AcceptGigRequest(id, reqid, reqUser, type) {
            function callback(address) {
                debugger
                if (address == 'error' || address == '') {
                    openbox(1, 'metamask_comfirmation_id_gig');
                    closebox('offer_comfirmation_id');
                }
                else {
                    $.ajax({
                        type: 'POST',
                        cache: false,
                        url: '@Url.Action("AcceptGigRequest", "Gigs")',
                        data: { 'type': type, 'gigId': id, 'reqId': reqid, "address": address },
                        beforeSend: function () {
                            $("#loaderDiv").show();
                        },
                        success: function (response) {
                            var _notification = "";
                            var _header = "";
                            var _Url = "";
                            if (response == "success") {
                                $("#loaderDiv").hide();
                                $('#gigRequest_title').text('Accepted service request');
                                $('#gigRequest_msg').html('You have accepted the service request from ' + reqUser);
                                _notification = _UserName + " has accepted your service order";
                                _header = "Service order accepted";
                                notification.server.send(_UserId, _ReqId, _ReqUser, _notification, _header, _Url);
                                //if(subscriptions == 1) {
                                //    $('#bottom_Offer').remove();
                                //    $('.dash_timeremain_corrent_offer_box_bg').remove();
                                //} else {
                                //    $('#border_buttom_' + _SubId).remove();
                                //    $('#div_offers_accept_' + _SubId).remove();
                                //}
                                //subscriptions--;
                                openbox(1, 'gigRequest_pop');
                                //window.location.reload();
                            } else {
                                $("#loaderDiv").hide();
                                $('#gigRequest_title').text('Cannot complete operation');
                                $('#gigRequest_msg').text('Something went wrong. Please try again.');
                                openbox(1, 'gigRequest_pop');
                            }
                        },
                        error: function (jqXHR, exception) {
                            $("#loaderDiv").hide();
                            console.log(jqXHR.status);
                            console.log(exception);
                        }
                    });
                }
            }
            App.getUserAddress(callback);
        }

        $('#gigRequestOk').click(function() {
            window.location.reload();
        });

        $('#btnyes1').unbind("click").bind( "click",function () {
            var _jobtitle = $("#hfjobtitle").val();
            var _jobid = $("#hfjobid").val();
            var _userrole = $("#hfuserrole").val();
            var _userid = ""
            if (_userrole == "P") {
                _userid = $("#hfseekerId").val();
                var name = $("#hfseekername").val();
                $("#spname").text(name);
                $("#spanrole").text("Review job seeker");
            }
            else if (_userrole == "S") {
                _userid = $("#hfuserid").val();
                var name = $("#hfpostername").val();
                $("#spname").text(name);
                $("#spanrole").text("Review job poster");
            }
            MarkasComplete(_jobid, _userid, _jobtitle, _userrole);
        });
    });

    function MarkasComplete(jobid, userid, jobtitle, userrole) {

        var chat = $.connection.chatHub;
        var notification = $.connection.notificationHub;
        var _hubid=  $.connection.hub.id;
        $.ajax({
            type: 'POST',
            cache: false,
            url: '@Url.Action("MarkasComplete", "Dashboard")',
            data: { 'JobId': jobid, 'UserRole': userrole, 'UserId': userid, 'JobTitle': jobtitle },
            success: function (response) {
                var _sendUserId= @Html.Raw(Json.Encode(Session["UserId"]));
                var _fullname = @Html.Raw(Json.Encode(Session["FullName"]));
                var _header = "Job completed";
                var _notification = "";
                var _receiverUserId = "";
                var _Url = "/Jobs/Details/" + jobid;
                var _gigSubId = $("#hfgigSubId").val();

                if (userrole == 'P') {
                    _receiverUserId = userid;
                    _notification =" Your payment for " + jobtitle + " is being processed and should be on its way";
                    $.connection.hub.start().done(function () {
                        notification.server.send(_sendUserId, _receiverUserId, _fullname, _notification, _header, _Url);
                    }).fail(function(){ console.log('Could not connect'); });;
                    //notification.server.send(_sendUserId, _receiverUserId, _fullname, _notification, _header, _Url);

                    var _posterid = $("#hfuserid").val();
                    function callback(result)
                    {
                        debugger;
                        if(result =="Success")
                        {
                            closebox('mark_complete_confirmation_pop_id');
                            if(_gigSubId > 0)
                            {
                                $("#divGigReview").css("display", "block");
                            }
                            else
                            {
                                $("#divGigReview").css("display", "none");
                            }
                            openbox(1, 'mark_complete_rating_pop_id');
                        }
                        else
                        {
                            closebox('mark_complete_confirmation_pop_id');
                        }
                    }
                    SaveTransactionDetail(jobid,_posterid,'S','C','',0,'',callback); // save spent transaction details
                    //SaveTransactionDetail.done(handleTransaction);
                    //SaveTransactionDetail(jobid, userid, 'E', 'C', '',0)// save earnt transaction details
                    @*var Url='@(System.Configuration.ConfigurationManager.AppSettings["EscrowUrl"].ToString())'
                    var socket = io.connect(Url);
                    socket.emit('transferToken', { jobid: jobid }); // raise an event on the server*@
                }
                else
                {
                    _receiverUserId = userid;
                    _notification ="@@"+@Html.Raw(Json.Encode(Session["UserName"]))  + " just marked " + jobtitle + " as complete - please check the job and when you're happy, mark it also as complete";
                    notification.server.send(_sendUserId, _receiverUserId, _fullname, _notification, _header, _Url);
                    closebox('mark_complete_confirmation_pop_id');
                    $("#divGigReview").css("display", "none");
                    openbox(1, 'mark_complete_rating_pop_id');
                }
            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.status);
                console.log(exception);
            }
        });
    }

    function SaveTransactionDetail(jobid, userid, transactiontype, processtype, hash, bidamount, address,callback) {

        $.ajax({
            type: 'POST',
            cache: false,
            url: '@Url.Action("SaveTransactionDetail", "Dashboard")',
            data: { 'JobId': jobid, 'UserId': userid, 'TransactionType': transactiontype, 'ProcessType': processtype, 'Hash': hash, 'BidAmount' : bidamount, 'Address' : address },
            success: function (response) {
                callback(response);

            },
            error: function (jqXHR, exception) {
                console.log(jqXHR.status);
                console.log(exception);
            }
        });
    }
</script>